<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <script type="module">
        import * as vg from 'https://unpkg.com/@uwdata/vgplot/dist/vgplot.min.js';
        
        async function loadData() {
            await vg.coordinator().exec([
                `CREATE TEMP TABLE IF NOT EXISTS flights10m AS SELECT GREATEST(-60, LEAST(ARR_DELAY, 180))::DOUBLE AS delay, DISTANCE AS distance, DEP_TIME AS time FROM 'http://localhost:8080/flights-10m.parquet'`
            ]);

            const $brush = vg.Selection.crossfilter();

            document.body.appendChild(
                vg.vconcat(
                    vg.plot(
                        vg.rectY(
                            vg.from("flights10m", { filterBy: $brush }),
                            { x: vg.bin("delay"), y: vg.count(), fill: "steelblue", inset: 0.5 }
                        ),
                        vg.intervalX({ as: $brush }),
                        vg.xDomain(vg.Fixed),
                        vg.marginLeft(75),
                        vg.width(600),
                        vg.height(200)
                    ),
                    vg.plot(
                        vg.rectY(
                            vg.from("flights10m", { filterBy: $brush }),
                            { x: vg.bin("time"), y: vg.count(), fill: "steelblue", inset: 0.5 }
                        ),
                        vg.intervalX({ as: $brush }),
                        vg.xDomain(vg.Fixed),
                        vg.marginLeft(75),
                        vg.width(600),
                        vg.height(200)
                    ),
                    vg.plot(
                        vg.rectY(
                            vg.from("flights10m", { filterBy: $brush }),
                            { x: vg.bin("distance"), y: vg.count(), fill: "steelblue", inset: 0.5 }
                        ),
                        vg.intervalX({ as: $brush }),
                        vg.xDomain(vg.Fixed),
                        vg.marginLeft(75),
                        vg.width(600),
                        vg.height(200)
                    )
                )
            );
        }

        loadData().catch(console.error);
    </script>
</head>

<body>

</body>

</html>